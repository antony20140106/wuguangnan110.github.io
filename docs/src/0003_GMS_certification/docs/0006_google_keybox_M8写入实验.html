<!DOCTYPE html>
<html class="writer-html5" lang="zh-CN" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>wugn</title>

      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/default.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/translations.js"></script>
        <script src="../../../_static/js/baidutongji.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="索引" href="../../../genindex.html" />
    <link rel="search" title="搜索" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../index.html" class="icon icon-home"> wugn_note
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="在文档中搜索" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <!-- Local TOC -->
              <div class="local-toc"><ul>
<li><a class="reference internal" href="#">概述</a></li>
<li><a class="reference internal" href="#id2">实验过程</a></li>
<li><a class="reference internal" href="#id3">第二次写号实验</a></li>
</ul>
</div>
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">wugn_note</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs"> 
<li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
<li>概述</li>
<li style="float: right;margin-left: 10px;"><a href="javascript:history.forward()">Forward</a></li>
<li style="float: right;margin-left: 10px;"><a href="javascript:history.back()">Go Back</a> | </li>
<li style="float: right;margin-left: 10px;"><a href="/index.html">Home</a> | </li>

      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="id1">
<h1>概述<a class="headerlink" href="#id1" title="此标题的永久链接"></a></h1>
<p>由于M5x项目的key用完了，只能用M8的key。</p>
</section>
<section id="id2">
<h1>实验过程<a class="headerlink" href="#id2" title="此标题的永久链接"></a></h1>
<ul class="simple">
<li><p>万鑫提供M5x的key下载地址如下：</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">url</span><span class="o">=</span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">192.168.199.3</span><span class="p">:</span><span class="mi">8446</span><span class="o">/</span><span class="n">vturkey</span>  <span class="n">巴西</span>
<span class="n">url</span><span class="o">=</span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">172.20.62.11</span><span class="p">:</span><span class="mi">8446</span><span class="o">/</span><span class="n">vturkey</span>    <span class="n">巴西tectoy</span>
<span class="n">url</span><span class="o">=</span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">192.168.0.232</span><span class="p">:</span><span class="mi">8446</span><span class="o">/</span><span class="n">vturkey</span>  <span class="n">深圳</span>
<span class="n">url</span><span class="o">=</span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">192.168.6.100</span><span class="p">:</span><span class="mi">8446</span><span class="o">/</span><span class="n">vturkey</span>  <span class="n">国内工厂</span>
</pre></div>
</div>
<ul class="simple">
<li><p>鸿祥源提供的uuid：</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>eea:
url=http://116.62.230.138/vturkey
keybox_uuid=6109_8711b2129be4a728ad78b37ac59b8b3e3292c535c9813fe228456bbc7f54fe0e

非eea：
url=http://116.62.230.138/vturkey
keybox_uuid=6109_a96ab590b693bc1dae449b1ca25299fe5bbcd025f92644453f5c60f2f1f32073
</pre></div>
</div>
<p>发现在公司只有深圳的地址能ping通，尝试使用深圳的进行下载，报错提示如下：</p>
<p><img alt="0006_0000.png" src="../../../_images/0006_00003.png" /></p>
<ul class="simple">
<li><p>SN tool出错打印：</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
 [09 25 11:08:15][ERR]&lt;__kpha_init&gt;: Device production processing failed with -19
 [09 25 11:08:15][ERR]&lt;KPHA_Init2&gt;: __kpha_init failed with kr = -19

 [09 25 14:12:31][INFO]&lt;__kpha_init&gt;: KPH: Begin. 4363
 [09 25 14:12:31][INFO]&lt;__kpha_init&gt;: Load Config from &quot;G:\M8项目\GMS\SN_Writer_Tool_exe_v10.2104.0.0-4363\tee_stuff\kph_in\kph_env.ini&quot; OK.
 [09 25 14:12:31][INFO]&lt;kpha_detect_server_mode&gt;: version: 3.4.1
 [09 25 14:12:31][INFO]&lt;__kpha_init&gt;: META Version: 3.4.1
 [09 25 14:12:32][INFO]&lt;get_cert_name&gt;: certname: xxx_M8_mt6765.dat
 [09 25 14:12:32][WARN]&lt;local_read&gt;: fopen(G:\M8项目\GMS\SN_Writer_Tool_exe_v10.2104.0.0-4363\tee_stuff\kph_in\xxx_M8_mt6765.dat) failed: No such file or directory
 [09 25 14:12:32][WARN]&lt;__kpha_init&gt;: xxx_M8_mt6765.dat not exist, certname_len : 17
 [09 25 14:12:32][INFO]&lt;__kpha_init&gt;: KPH: DEVICE [SN: &lt;7CC02E0500000000&gt; CHIPID: &lt;b52f26ad4fba5f1ac44b7c01564c13b6&gt;] start
 [09 25 14:12:32][INFO]&lt;__kpha_init&gt;: __kpha_init device_status version 2 &gt;= 2, use truststore API to get truststore type
 [09 25 14:12:32][INFO]&lt;__kpha_init&gt;: TRUSTSTORE_TYPE: 4 TRUSTSTORE_status: 1
 [09 25 14:12:32][INFO]&lt;__kpha_init&gt;: CFG already imported. Done
 [09 25 14:12:32][INFO]&lt;__kpha_init&gt;: Export Device Info. Done
 [09 25 14:12:32][INFO]&lt;__kpha_init&gt;: Export Key&lt;0&gt;. Done
 [09 25 14:12:32][INFO]&lt;__kpha_init&gt;: Read Output. Done
 [09 25 14:12:32][NOTICE]&lt;__kpha_init&gt;: KPH: DEVICE [SN: &lt;7CC02E0500000000&gt; CHIPID: &lt;b52f26ad4fba5f1ac44b7c01564c13b6&gt;] Complete.
 [09 25 14:12:32][INFO]&lt;__kpha_init&gt;: Program Secondary certificate.
 [09 25 14:12:32][INFO]&lt;trustkernel::VTurkeyLicenser::secondaryCertRequest&gt;: device={&quot;deviceInfo&quot;:{&quot;androidVersion&quot;:&quot;30&quot;,&quot;ekPubkey&quot;:&quot;-----BEGIN PUBLIC KEY-----\nMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEArL6O4oSO9Sab8nHENf2X\ncLcLrGZ/moc387Rul8RzZmGouiGpJ5HfNRvnCIs+7jcCNKi5wNgPjMTfpCYyhi+S\noRktqFKYw9LDbc95xty3NvEye9Q/iZdHZiea2u9qhNulZnulXBTZ7x457Giem5YT\ndrFxZZxcUanAl0ikMMUSkaOTeA5cofctkKOr/fpizvfjbNQ0YVdVdeWFM8Mup2aO\n13afxB3THV70iFPTeXoi1WdgFVQQCE0aeidelWprh40q0whIujMzvSHXxb+ZrSPW\nHy+84KZ/BMbRx+c0bOai4bFLHHIuQ5ivt3kpM5w6z22x23YVtHjot/bxFvTMkhDt\nUwIDAQAB\n-----END PUBLIC KEY-----&quot;,&quot;reeUuid&quot;:&quot;b52f26ad4fba5f1ac44b7c01564c13b6&quot;,&quot;teeOsVersion&quot;:&quot;v0.9.9&quot;,&quot;teeOsVersionAll&quot;:&quot;v0.9.9-gp-35-g17b24987-mt6765-pie-mo-kme-fp-mtk-release&quot;,&quot;teeUuid&quot;:&quot;3d38e45cb3311058b17d64ceabcdf9a4&quot;},&quot;turkey&quot;:{&quot;digest&quot;:&quot;57b603755edbeee2cf65ed80f5898748b2124bde28815e6366912673978e20eb&quot;,&quot;keyId&quot;:1,&quot;keyboxUuid&quot;:&quot;5978_7f5b1cee659bae688335723e0ffc893e2ad9a59eefa13eed77ae81ebffc7a553&quot;,&quot;nonce&quot;:899613900,&quot;requireKeybox&quot;:true}}

 [09 25 14:12:33][ERR]&lt;trustkernel::VTurkeyLicenser::secondaryCertRequest&gt;: post VTurkey secondary cert failed with 105(Credit used up锛屼骇绾夸綑棰濅笉瓒筹紝璇锋鏌SS涓婂搴旈」鐩殑鍙垎閰嶄綑棰?
 [09 25 14:12:33][ERR]&lt;trustkernel::VTurkeyLicenser::issueSecondaryLicense&gt;: Upload failed with -1

 [09 25 14:12:33][ERR]&lt;__kpha_init&gt;: Device production processing failed with -19
 [09 25 14:12:33][ERR]&lt;KPHA_Init2&gt;: __kpha_init failed with kr = -19
</pre></div>
</div>
<ul class="simple">
<li><p>PPQ工具报错一样，如下：</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>11:33:22&gt; [09 25 11:32:58][ERR]&lt;KPHA_Init2&gt;: __kpha_init failed with kr = -19
11:33:22&gt; [09 25 11:32:58][ERR]&lt;__kpha_init&gt;: Device production processing failed with -19
11:33:22&gt; [09 25 11:32:58][ERR]&lt;trustkernel::VTurkeyLicenser::issueSecondaryLicense&gt;: Upload failed with -1
11:33:22&gt; [09 25 11:32:58][ERR]&lt;trustkernel::VTurkeyLicenser::secondaryCertRequest&gt;: post VTurkey secondary cert failed with 100(Invalid keybox uuid锛岄潪娉曠殑keyboxUuid,璇锋牎楠宬eyboxUuid鏄惁姝ｇ‘)
11:33:22&gt; [09 25 11:32:57][INFO]&lt;trustkernel::VTurkeyLicenser::secondaryCertRequest&gt;: device={&quot;deviceInfo&quot;:{&quot;androidVersion&quot;:&quot;30&quot;,&quot;ekPubkey&quot;:&quot;-----BEGIN PUBLIC KEY-----\nMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEArL6O4oSO9Sab8nHENf2X\ncLcLrGZ/moc387Rul8RzZmGouiGpJ5HfNRvnCIs+7jcCNKi5wNgPjMTfpCYyhi+S\noRktqFKYw9LDbc95xty3NvEye9Q/iZdHZiea2u9qhNulZnulXBTZ7x457Giem5YT\ndrFxZZxcUanAl0ikMMUSkaOTeA5cofctkKOr/fpizvfjbNQ0YVdVdeWFM8Mup2aO\n13afxB3THV70iFPTeXoi1WdgFVQQCE0aeidelWprh40q0whIujMzvSHXxb+ZrSPW\nHy+84KZ/BMbRx+c0bOai4bFLHHIuQ5ivt3kpM5w6z22x23YVtHjot/bxFvTMkhDt\nUwIDAQAB\n-----END PUBLIC KEY-----&quot;,&quot;reeUuid&quot;:&quot;b52f26ad4fba5f1ac44b7c01564c13b6&quot;,&quot;teeOsVersion&quot;:&quot;v0.9.9&quot;,&quot;teeOsVersionAll&quot;:&quot;v0.9.9-gp-35-g17b24987-mt6765-pie-mo-kme-fp-mtk-release&quot;,&quot;teeUuid&quot;:&quot;3d38e45cb3311058b17d64ceabcdf9a4&quot;},&quot;turkey&quot;:{&quot;digest&quot;:&quot;57b603755edbeee2cf65ed80f5898748b2124bde28815e6366912673978e20eb&quot;,&quot;keyId&quot;:1,&quot;keyboxUuid&quot;:&quot;6109_a96ab590b693bc1dae449b1ca25299fe5bbcd025f92644453f5c60f2f1f32073&quot;,&quot;nonce&quot;:2198996757,&quot;requireKeybox&quot;:true}}
11:33:22&gt; [09 25 11:32:57][INFO]&lt;__kpha_init&gt;: Program Secondary certificate.
11:33:22&gt; [09 25 11:32:57][NOTICE]&lt;__kpha_init&gt;: KPH: DEVICE [SN: &lt;7CC02E0500000000&gt; CHIPID: &lt;b52f26ad4fba5f1ac44b7c01564c13b6&gt;] Complete.
11:33:22&gt; [09 25 11:32:57][INFO]&lt;__kpha_init&gt;: Read Output. Done
11:33:22&gt; [09 25 11:32:57][INFO]&lt;__kpha_init&gt;: Export Key&lt;0&gt;. Done
11:33:22&gt; [09 25 11:32:57][INFO]&lt;__kpha_init&gt;: Export Device Info. Done
11:33:22&gt; [09 25 11:32:57][INFO]&lt;__kpha_init&gt;: CFG already imported. Done
11:33:22&gt; [09 25 11:32:57][INFO]&lt;__kpha_init&gt;: TRUSTSTORE_TYPE: 4 TRUSTSTORE_status: 1
11:33:22&gt; [09 25 11:32:57][INFO]&lt;__kpha_init&gt;: __kpha_init device_status version 2 &gt;= 2, use truststore API to get truststore type
11:33:22&gt; [09 25 11:32:57][INFO]&lt;__kpha_init&gt;: KPH: DEVICE [SN: &lt;7CC02E0500000000&gt; CHIPID: &lt;b52f26ad4fba5f1ac44b7c01564c13b6&gt;] start
11:33:22&gt; [09 25 11:32:57][WARN]&lt;__kpha_init&gt;: xxx_M8_mt6765.dat not exist, certname_len : 17
11:33:22&gt; [09 25 11:32:57][WARN]&lt;local_read&gt;: fopen(G:\PPQ_MP_M5x_20210826\bin\MTK\MTKSNWriter\tee_stuff\kph_in\xxx_M8_mt6765.dat) failed: No such file or directory
11:33:22&gt; [09 25 11:32:57][INFO]&lt;get_cert_name&gt;: certname: xxx_M8_mt6765.dat
11:33:22&gt; [09 25 11:32:56][INFO]&lt;__kpha_init&gt;: META Version: 3.4.1
11:33:22&gt; [09 25 11:32:56][INFO]&lt;kpha_detect_server_mode&gt;: version: 3.4.1
11:33:22&gt; [09 25 11:32:56][INFO]&lt;__kpha_init&gt;: Load Config from &quot;G:\PPQ_MP_M5x_20210826\bin\MTK\MTKSNWriter\tee_stuff\kph_in\kph_env.ini&quot; OK.
11:33:22&gt; [09 25 11:32:56][INFO]&lt;__kpha_init&gt;: KPH: Begin. 4363
11:33:21&gt;setkeybox=0%
11:33:21&gt;setkeybox
</pre></div>
</div>
</section>
<section id="id3">
<h1>第二次写号实验<a class="headerlink" href="#id3" title="此标题的永久链接"></a></h1>
<p>上次实验失败是因为服务器地址及uuid不对，以及必须使用user版本进行验证。今天的实验情况如下：</p>
<p>1.杨文亚提供M8非EEA的key下载地址和uuid如下，该地址可以进行googlekey下载及激活：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">url</span><span class="o">=</span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">pl</span><span class="o">.</span><span class="n">trustkernel</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">vturkey</span>
<span class="n">keybox_uuid</span><span class="o">=</span><span class="mi">6109</span><span class="n">_bafc4363713178c1b2a24b04cf64d84a93e516c2da014de8017ec251c765cd3c</span>
</pre></div>
</div>
<p>2.https://oss.trustkernel.com/官网查询M8非EEA的key剩余数量为5995个：</p>
<p><img alt="0006_0001.png" src="../../../_images/0006_00012.png" /></p>
<p>3.兼容方案目前还在验证中，思路如下：
（1）公钥文件兼容：公钥文件存在于文件系统中，机型通过boardid区分，在开机时判断，新老机器文件系统中拷贝不同的公钥文件。
（2）证书文件兼容：证书文件存在于tee分区，tee分区只在工厂第一次烧录时进行，后续发布的OTA及Uniphiz包都不包含该镜像，防止老机器证书被覆盖。</p>
<p>4.如沟通，老产品兼容方案目前基本能够实验，存在以下两个缺点：
（1）新机器需要修改硬件boardid，和旧机器进行区分。
（2）新机器无法回退以前的软件，否则会覆盖公钥文件。</p>
</section>


           </div>
         <div class="articleComments">
               <comments>
  <script src="https://utteranc.es/client.js"
    repo="iswbm/magic-python"
    issue-term="pathname"
    theme="github-light"
    crossorigin="anonymous"
    async>
  </script>
</comments>
           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; 版权所有 2022, wugn.</p>
  </div>

  利用 <a href="https://www.sphinx-doc.org/">Sphinx</a> 构建，使用了 
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">主题</a>
    由 <a href="https://readthedocs.org">Read the Docs</a>开发.
  

<script charset="UTF-8" id="LA_COLLECT" src="//sdk.51.la/js-sdk-pro.min.js"></script>
<script>LA.init({id: "JoV5csIHTGhHiGQ4",ck: "JoV5csIHTGhHiGQ4"})</script>

<br/>
<script id="LA-DATA-WIDGET" crossorigin="anonymous" charset="UTF-8" src="https://v6-widget.51.la/v6/JoV5csIHTGhHiGQ4/quote.js?theme=#4C8AC2,#BB2626,#040000,#333333,#AE3535,#1690FF,14&f=14"></script>



</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>