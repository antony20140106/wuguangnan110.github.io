<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>wugn</title>

      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/default.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../index.html" class="icon icon-home"> wugn_note
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <!-- Local TOC -->
              <div class="local-toc"><ul>
<li><a class="reference internal" href="#">概述</a></li>
<li><a class="reference internal" href="#id2">参考</a></li>
<li><a class="reference internal" href="#id3">硬件</a></li>
<li><a class="reference internal" href="#id4">分析</a></li>
</ul>
</div>
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">wugn_note</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs"> 
<li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
<li>概述</li>
<li style="float: right;margin-left: 10px;"><a href="javascript:history.forward()">Forward</a></li>
<li style="float: right;margin-left: 10px;"><a href="javascript:history.back()">Go Back</a> | </li>
<li style="float: right;margin-left: 10px;"><a href="/index.html">Home</a> | </li>

      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="id1">
<h1>概述<a class="headerlink" href="#id1" title="Permalink to this heading"></a></h1>
<p>高通A6650 charger mp2250架构理解。</p>
</section>
<section id="id2">
<h1>参考<a class="headerlink" href="#id2" title="Permalink to this heading"></a></h1>
<ul class="simple">
<li><p><span class="xref myst">0012_移远提供外置电量计移植培训</span></p></li>
<li><p><span class="xref myst">mp2721_datasheet</span></p></li>
<li><p><span class="xref myst">prolin_mp2723_kernel4.14参考代码</span></p></li>
</ul>
</section>
<section id="id3">
<h1>硬件<a class="headerlink" href="#id3" title="Permalink to this heading"></a></h1>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">I2C</span> <span class="n">Slave</span> <span class="n">Address</span><span class="p">:</span> <span class="mi">3</span><span class="n">Fh</span>

</pre></div>
</div>
</section>
<section id="id4">
<h1>分析<a class="headerlink" href="#id4" title="Permalink to this heading"></a></h1>
<ul class="simple">
<li><p>首先查看高通原始用的charger，<code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">menuconfug-&gt;</span> <span class="pre">Device</span> <span class="pre">Drivers</span> <span class="pre">&gt;</span> <span class="pre">Power</span> <span class="pre">supply</span> <span class="pre">class</span> <span class="pre">support</span> <span class="pre">&gt;</span> <span class="pre">Qualcomm</span> <span class="pre">Technologies,</span> <span class="pre">Inc.</span> <span class="pre">Charger</span> <span class="pre">and</span> <span class="pre">Fuel</span> <span class="pre">Gauge</span> <span class="pre">support</span></code>如下，可以看到是<code class="docutils literal notranslate"><span class="pre">SMB1355</span> <span class="pre">Slave</span> <span class="pre">Battery</span> <span class="pre">Charger</span></code>和<code class="docutils literal notranslate"><span class="pre">SMB1398</span> <span class="pre">power</span> <span class="pre">supply</span> <span class="pre">framework</span> <span class="pre">based</span> <span class="pre">driver</span></code>:</p></li>
</ul>
<p><img alt="0012_0000.png" src="../../../_images/0012_0000.png" /></p>
<p>对应Kconfig及文件如下：</p>
<div class="highlight-C++ notranslate"><div class="highlight"><pre><span></span>Kconfig:
config SMB1355_SLAVE_CHARGER
        tristate &quot;SMB1355 Slave Battery Charger&quot;
        depends on MFD_I2C_PMIC
        help
          Say Y to include support for SMB1355 Battery Charger.
          SMB1355 is a single phase 5A battery charger.
          The driver supports charger enable/disable.
          The driver reports the charger status via the power supply framework.
          A charger status change triggers an IRQ via the device STAT pin.

config SMB1398_CHARGER
        tristate &quot;SMB1398 power supply framework based driver&quot;
        depends on MFD_I2C_PMIC
        help
          Say Y to include the support of SMB1398 Charge driver based on power
          supply framework.
          SMB1398 is a combo charger chip which can work in different modes:
          (1) DIV2 charge pump mode to work as a companion charger to be paired
              with Qualcomm Technologies, Inc.’s family of standalone chargers;
          (2) DIV2 and 3-level buck combo mode to regulate the output power from
              wireless charger receiver and provide the input for downstream
              chargers.

config QPNP_SMB5
        tristate &quot;SMB5 Battery Charger&quot;
        depends on MFD_SPMI_PMIC
        help
          Say Y to enables support for the SMB5 charging peripheral.
          The QPNP SMB5 charger driver supports the charger peripheral
          present in the chip.
          The power supply framework is used to communicate battery and
          usb properties to userspace and other driver consumers such
          as fuel gauge, USB, and USB-PD.
          VBUS and VCONN regulators are registered for supporting OTG,
          and powered Type-C cables respectively.

config QPNP_SMBLITE
        tristate &quot;SMBLITE Battery Charger&quot;
        depends on MFD_SPMI_PMIC
        help
          Say Y to enables support for the SMBLITE charging peripheral.
          The QPNP SMBLITE charger driver supports the charger peripheral
          present in the chip.
          The power supply framework is used to communicate battery and
          usb properties to userspace and other driver consumers such
          as fuel gauge and USB.
          VBUS regulator is registered for supporting OTG.

config QPNP_QG
        bool &quot;QPNP Qgauge driver&quot;
        depends on MFD_SPMI_PMIC
        help
          Say Y here to enable the Qualcomm Technologies, Inc. QGauge driver
          which uses the periodic sampling of the battery voltage and current
          to determine the battery state-of-charge (SOC) and supports other
          battery management features.


Makefile:
obj-$(CONFIG_SMB1355_SLAVE_CHARGER)     += smb1355-charger.o pmic-voter.o
obj-$(CONFIG_SMB1398_CHARGER)           += smb1398-charger.o pmic-voter.o

obj-$(CONFIG_QPNP_QG)                   += qpnp-qg.o pmic-voter.o qg-util.o qg-soc.o qg-sdam.o qg-battery-profile.o qg-profile-lib.o fg-alg.o

obj-$(CONFIG_QPNP_SMB5)                 += step-chg-jeita.o battery.o qpnp-smb5.o smb5-lib.o pmic-voter.o storm-watch.o schgm-flash.o
obj-$(CONFIG_QPNP_SMBLITE)              += step-chg-jeita.o battery.o qpnp-smblite.o smblite-lib.o pmic-voter.o storm-watch.o schgm-flashlite.o
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">vendor/bengal-perf_defconfig</span></code>发现以下：</p></li>
</ul>
<div class="highlight-makefile notranslate"><div class="highlight"><pre><span></span>CONFIG_QPNP_QG
CONFIG_SMB1398_CHARGER
CONFIG_SMB1355_SLAVE_CHARGER
CONFIG_QPNP_SMBLITE
CONFIG_QPNP_SMB5

Makefile:
obj-$(CONFIG_QPNP_SMB5)                 += step-chg-jeita.o battery.o qpnp-smb5.o smb5-lib.o pmic-voter.o storm-watch.o schgm-flash.o
obj-$(CONFIG_QPNP_QG)                   += qpnp-qg.o pmic-voter.o qg-util.o qg-soc.o qg-sdam.o qg-battery-profile.o qg-profile-lib.o fg-alg.o
obj-$(CONFIG_QPNP_SMBLITE)              += step-chg-jeita.o battery.o qpnp-smblite.o smblite-lib.o pmic-voter.o storm-watch.o 
obj-$(CONFIG_SMB1355_SLAVE_CHARGER)     += smb1355-charger.o pmic-voter.o
obj-$(CONFIG_SMB1398_CHARGER)           += smb1398-charger.o pmic-voter.oschgm-flashlite.o
</pre></div>
</div>
<ul class="simple">
<li><p>dts中匹配到的文件如下:</p></li>
</ul>
<div class="highlight-log notranslate"><div class="highlight"><pre><span></span>qpnp-smb5.c:未添加
wugn@jcrj-tf-compile:a6650$ ack qcom,qpnp-smb5

qpnp-smblite.c:已添加
wugn@jcrj-tf-compile:a6650$ ack qcom,qpnp-smb
pm2250.dtsi
227:            pm2250_charger: qcom,qpnp-smblite {
228:                    compatible = &quot;qcom,qpnp-smblite&quot;;

smb1398-charger.c:未添加
wugn@jcrj-tf-compile:a6650$ ack qcom,smb1398-charger
smb1355-charger.c：未添加
wugn@jcrj-tf-compile:a6650$ ack parallel

qpnp-qg.c:添加了qcom,qpnp-qg-lite驱动：
wugn@jcrj-tf-compile:a6650$ ack qcom,qpnp-qg
pm2250.dtsi
193:                    compatible = &quot;qcom,qpnp-qg-lite&quot;;
wugn@jcrj-tf-compile:a6650$
</pre></div>
</div>
<p>也就是说目前qcm2290中用到如下文件：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>obj-$(CONFIG_QPNP_QG)                   += qpnp-qg.o pmic-voter.o qg-util.o qg-soc.o qg-sdam.o qg-battery-profile.o qg-profile-lib.o fg-alg.o
obj-$(CONFIG_QPNP_SMBLITE)              += step-chg-jeita.o battery.o qpnp-smblite.o smblite-lib.o pmic-voter.o storm-watch.o 
</pre></div>
</div>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, wugn.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
  

<script charset="UTF-8" id="LA_COLLECT" src="//sdk.51.la/js-sdk-pro.min.js"></script>
<script>LA.init({id: "JjOE14XScyd75b2C",ck: "JjOE14XScyd75b2C"})</script>

<br/>
<script id="LA-DATA-WIDGET" crossorigin="anonymous" charset="UTF-8" src="https://v6-widget.51.la/v6/JjOE14XScyd75b2C/quote.js?theme=0&f=12&display=1,0,0,0,0,0,1,1"></script>



</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>