<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>wugn</title>

      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/default.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../index.html" class="icon icon-home"> wugn_note
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <!-- Local TOC -->
              <div class="local-toc"><ul>
<li><a class="reference internal" href="#">概述</a><ul>
<li><a class="reference internal" href="#id2">检测认证方法</a></li>
<li><a class="reference internal" href="#id3">判定条件</a></li>
<li><a class="reference internal" href="#id4">程序实现</a><ul>
<li><a class="reference internal" href="#id5">1.指纹相关</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id6">问题分析</a><ul>
<li><a class="reference internal" href="#modem-metaconnect">1.modem meta无法connect</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">wugn_note</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs"> 
<li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
<li>概述</li>
<li style="float: right;margin-left: 10px;"><a href="javascript:history.forward()">Forward</a></li>
<li style="float: right;margin-left: 10px;"><a href="javascript:history.back()">Go Back</a> | </li>
<li style="float: right;margin-left: 10px;"><a href="/index.html">Home</a> | </li>

      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="id1">
<h1>概述<a class="headerlink" href="#id1" title="Permalink to this headline"></a></h1>
<p>讲解GMS认证判定是否是认证机器的条件及避开技巧。</p>
<section id="id2">
<h2>检测认证方法<a class="headerlink" href="#id2" title="Permalink to this headline"></a></h2>
<p>[Test Plan]:</p>
<ul class="simple">
<li><p>(1)需要在GMS下测试;</p></li>
<li><p>(2)SafetyNet要测试通过;
测试方法：下载SafetyNet测试应用，打开运行 -&gt; “RUN SAFETYNET TEST”。
测试结果： “CTS profile match” 和 “Basic Integrity” 均为true 的情况为测试通过；否则测试失败。</p></li>
<li><p>(3)Google Play Store要显示设备已通过认证；
Google Play Store的 “Settings” -&gt; “Play Protect certification” 要显示
“Device is certified”， 表示设备通过认证。</p></li>
<li><p>(4)设置中显示的Android安全补丁日期与ro.build.security_patch.pax属性值一致。
查看Settings -&gt; About device -&gt; Android version -&gt; Android security update</p></li>
<li><p>safetynettest.apk：</p></li>
<li><p><a class="reference download internal" download="" href="../../../_downloads/081b868e9d584c6751eb43d16abb03b2/0002_google%E8%AE%A4%E8%AF%81%E6%B5%8B%E8%AF%95safetynettest.apk"><span class="xref download myst">0002_google认证测试safetynettest.apk</span></a></p></li>
</ul>
<p>safetynettest认证成功：
<img alt="0002_screen.png" src="../../../_images/0002_screen.png" /></p>
<p>google play认证成功：
<img alt="0002_google_play_cer_pass.png" src="../../../_images/0002_google_play_cer_pass.png" /></p>
</section>
<section id="id3">
<h2>判定条件<a class="headerlink" href="#id3" title="Permalink to this headline"></a></h2>
<p>参考：</p>
<ul class="simple">
<li><p><a class="reference external" href="https://www.didgeridoohan.com/magisk/MagiskHideSafetyNet">Magisk and MagiskHide Installation and Troubleshooting guide : MagiskHideSafetyNet</a></p></li>
</ul>
<p><img alt="0002_判定条件.png" src="src/0003_GMS/docs/images/0002_%E5%88%A4%E5%AE%9A%E6%9D%A1%E4%BB%B6.png" /></p>
<p>总结以下几点：</p>
<ul class="simple">
<li><p>1.设备BootLoader未解锁。</p></li>
<li><p>2.第一是要确保系统文件的完整性，不能被篡改，这一点既是关键又是前提*(这里的“系统文件”可能不单单指System 分区中的文件，最近我发现，有些设备的校验好像比较严格，相同操作条件下，使用了第三方Recovery 就无法通过校验，此时System 分区并没有解锁，并没有修改)。</p></li>
<li><p>3.要通过CTS（Compatibility Test Suite 兼容测试）认证，其过程可以简单理解为设备的系统指纹（fingerprint）信息必须提交给Google方面审核，Google审核通过后他们的服务器才会添加上这个设备的系统指纹信息。</p></li>
<li><p>4.ro.build.fingerprint and possibly ro.build.version.security_patch 属性必须是提交给google的。</p></li>
</ul>
</section>
<section id="id4">
<h2>程序实现<a class="headerlink" href="#id4" title="Permalink to this headline"></a></h2>
<section id="id5">
<h3>1.指纹相关<a class="headerlink" href="#id5" title="Permalink to this headline"></a></h3>
<p>1.指纹属性赋值在init进程中：</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">property_derive_build_fingerprint</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">build_fingerprint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetProperty</span><span class="p">(</span><span class="s">&quot;ro.build.fingerprint&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">build_fingerprint</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">UNKNOWN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;unknown&quot;</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">error</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="c1">//[FEATURE]-Add-BEGIN by (qumy@paxsz.com), 2021/08/11, modify pro ro.build.version.incremental</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">payphonem50</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;2106041716&quot;</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">payphonem50eea</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;2106082124&quot;</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">paytabletm8</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;2106041717&quot;</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">paytabletm8eea</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;2106082125&quot;</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">GetProperty</span><span class="p">(</span><span class="s">&quot;ro.boot.terminal_name&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">UNKNOWN</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;M8&quot;</span><span class="p">){</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">GetProperty</span><span class="p">(</span><span class="s">&quot;ro.paxdroid.name&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">UNKNOWN</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;k62v1_64_pax&quot;</span><span class="p">){</span><span class="w"></span>
<span class="w">                </span><span class="n">PropertySet</span><span class="p">(</span><span class="s">&quot;ro.build.version.incremental&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">paytabletm8</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">error</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="k">else</span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="n">PropertySet</span><span class="p">(</span><span class="s">&quot;ro.build.version.incremental&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">paytabletm8eea</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">error</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="p">}</span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="p">(</span><span class="n">GetProperty</span><span class="p">(</span><span class="s">&quot;ro.boot.terminal_name&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">UNKNOWN</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;M50&quot;</span><span class="p">){</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">GetProperty</span><span class="p">(</span><span class="s">&quot;ro.paxdroid.name&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">UNKNOWN</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;k62v1_64_pax&quot;</span><span class="p">){</span><span class="w"></span>
<span class="w">        </span><span class="n">PropertySet</span><span class="p">(</span><span class="s">&quot;ro.build.version.incremental&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">payphonem50</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">error</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="k">else</span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">PropertySet</span><span class="p">(</span><span class="s">&quot;ro.build.version.incremental&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">payphonem50eea</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">error</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="c1">//[FEATURE]-Add-END by (qumy@paxsz.com), 2021/08/11,</span>
<span class="w">    </span><span class="n">build_fingerprint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetProperty</span><span class="p">(</span><span class="s">&quot;ro.product.brand&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">UNKNOWN</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">build_fingerprint</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="sc">&#39;/&#39;</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="c1">//[FEATURE]-Add-BEGIN by (wugangnan@paxsz.com), 2021/05/11, set some fingerprint prop for GMS</span>
<span class="w">    </span><span class="n">build_fingerprint</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">GetProperty</span><span class="p">(</span><span class="s">&quot;ro.boot.terminal_name&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">UNKNOWN</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="c1">//[FEATURE]-Add-BEGIN by (wugangnan@paxsz.com), 2021/08/06, for eea product</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">GetProperty</span><span class="p">(</span><span class="s">&quot;ro.paxdroid.name&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">UNKNOWN</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;k62v1_64_pax_eea&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">build_fingerprint</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="sc">&#39;_&#39;</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">build_fingerprint</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="sc">&#39;E&#39;</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">build_fingerprint</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="sc">&#39;E&#39;</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">build_fingerprint</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="sc">&#39;A&#39;</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="n">build_fingerprint</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="sc">&#39;/&#39;</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">build_fingerprint</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="sc">&#39;P&#39;</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">build_fingerprint</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="sc">&#39;A&#39;</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">build_fingerprint</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="sc">&#39;Y&#39;</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="k">if</span><span class="p">(</span><span class="n">GetProperty</span><span class="p">(</span><span class="s">&quot;ro.boot.terminal_name&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">UNKNOWN</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;M8&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">build_fingerprint</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="sc">&#39;T&#39;</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">build_fingerprint</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="sc">&#39;A&#39;</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">build_fingerprint</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="sc">&#39;B&#39;</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">build_fingerprint</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="sc">&#39;L&#39;</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">build_fingerprint</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="sc">&#39;E&#39;</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">build_fingerprint</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="sc">&#39;T&#39;</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="p">}</span><span class="k">else</span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">build_fingerprint</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="sc">&#39;P&#39;</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">build_fingerprint</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="sc">&#39;H&#39;</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">build_fingerprint</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="sc">&#39;O&#39;</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">build_fingerprint</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="sc">&#39;N&#39;</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">build_fingerprint</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="sc">&#39;E&#39;</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="n">build_fingerprint</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">GetProperty</span><span class="p">(</span><span class="s">&quot;ro.boot.terminal_name&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">UNKNOWN</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="c1">//[FEATURE]-Add-BEGIN by (wugangnan@paxsz.com), 2021/08/06, for eea product for eea,not to add _M8</span>
<span class="w">    </span><span class="c1">// if (GetProperty(&quot;ro.paxdroid.name&quot;, UNKNOWN) == &quot;k62v1_64_pax_eea&quot; &amp;&amp; GetProperty(&quot;ro.boot.terminal_name&quot;, UNKNOWN) == &quot;M8&quot;) {</span>
<span class="w">    </span><span class="c1">//  build_fingerprint += &#39;_&#39;;</span>
<span class="w">    </span><span class="c1">//  build_fingerprint += &#39;E&#39;;</span>
<span class="w">    </span><span class="c1">//  build_fingerprint += &#39;E&#39;;</span>
<span class="w">    </span><span class="c1">//  build_fingerprint += &#39;A&#39;;</span>
<span class="w">    </span><span class="c1">// }</span>
<span class="w">    </span><span class="c1">//[FEATURE]-Add-END by (wugangnan@paxsz.com), 2021/08/06, for eea product</span>
<span class="w">    </span><span class="c1">//[FEATURE]-Add-END by (wugangnan@paxsz.com), 2021/05/11, set some fingerprint prop for GMS</span>
<span class="w">    </span><span class="n">build_fingerprint</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="sc">&#39;:&#39;</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">build_fingerprint</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">GetProperty</span><span class="p">(</span><span class="s">&quot;ro.build.version.release&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">UNKNOWN</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">build_fingerprint</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="sc">&#39;/&#39;</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">build_fingerprint</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">GetProperty</span><span class="p">(</span><span class="s">&quot;ro.build.id&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">UNKNOWN</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">build_fingerprint</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="sc">&#39;/&#39;</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">build_fingerprint</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">GetProperty</span><span class="p">(</span><span class="s">&quot;ro.build.version.incremental&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">UNKNOWN</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">build_fingerprint</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="sc">&#39;:&#39;</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">build_fingerprint</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">GetProperty</span><span class="p">(</span><span class="s">&quot;ro.build.type&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">UNKNOWN</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">build_fingerprint</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="sc">&#39;/&#39;</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">build_fingerprint</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">GetProperty</span><span class="p">(</span><span class="s">&quot;ro.build.tags&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">UNKNOWN</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="n">LOG</span><span class="p">(</span><span class="n">INFO</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Setting property &#39;ro.build.fingerprint&#39; to &#39;&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">build_fingerprint</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;&#39;&quot;</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PropertySet</span><span class="p">(</span><span class="s">&quot;ro.build.fingerprint&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">build_fingerprint</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">error</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="c1">//[FEATURE]-Add-BEGIN by (wugangnan@paxsz.com), 2021/05/11, set some fingerprint prop for GMS</span>
<span class="w">    </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PropertySet</span><span class="p">(</span><span class="s">&quot;ro.bootimage.build.fingerprint&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">build_fingerprint</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">error</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PropertySet</span><span class="p">(</span><span class="s">&quot;ro.odm.build.fingerprint&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">build_fingerprint</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">error</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PropertySet</span><span class="p">(</span><span class="s">&quot;ro.system.build.fingerprint&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">build_fingerprint</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">error</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PropertySet</span><span class="p">(</span><span class="s">&quot;ro.system_ext.build.fingerprint&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">build_fingerprint</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">error</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PropertySet</span><span class="p">(</span><span class="s">&quot;ro.vendor.build.fingerprint&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">build_fingerprint</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">error</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PropertySet</span><span class="p">(</span><span class="s">&quot;ro.product.build.fingerprint&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">build_fingerprint</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">error</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="c1">//[FEATURE]-Add-BEGIN by (wugangnan@paxsz.com), 2021/05/11, set some fingerprint prop for GMS</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">res</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">PROP_SUCCESS</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">LOG</span><span class="p">(</span><span class="n">ERROR</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Error setting property &#39;ro.build.fingerprint&#39;: err=&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">res</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; (&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">error</span><span class="w"></span>
<span class="w">                   </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;)&quot;</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>部分其他修改请参考 <a class="reference internal" href="0003_GMS%E7%B3%BB%E7%BB%9F%E5%B1%9E%E6%80%A7%E5%AE%9A%E5%88%B6.html"><span class="doc std std-doc">GMS系统属性定制</span></a></p>
<ul class="simple">
<li><p>结果：</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">M50</span><span class="p">:</span>
<span class="p">[</span><span class="n">ro</span><span class="o">.</span><span class="n">build</span><span class="o">.</span><span class="n">fingerprint</span><span class="p">]:</span> <span class="p">[</span><span class="n">PAX</span><span class="o">/</span><span class="n">M50_EEA</span><span class="o">/</span><span class="n">PAYPHONEM50</span><span class="p">:</span><span class="mi">11</span><span class="o">/</span><span class="n">RP1A</span><span class="mf">.200720.011</span><span class="o">/</span><span class="mi">2106082124</span><span class="p">:</span><span class="n">user</span><span class="o">/</span><span class="n">release</span><span class="o">-</span><span class="n">keys</span><span class="p">]</span>

<span class="n">M8</span><span class="p">:</span>
<span class="p">[</span><span class="n">ro</span><span class="o">.</span><span class="n">build</span><span class="o">.</span><span class="n">fingerprint</span><span class="p">]:</span> <span class="p">[</span><span class="n">PAX</span><span class="o">/</span><span class="n">M8_EEA</span><span class="o">/</span><span class="n">PAYPHONEM50</span><span class="p">:</span><span class="mi">11</span><span class="o">/</span><span class="n">RP1A</span><span class="mf">.200720.011</span><span class="o">/</span><span class="mi">2106082124</span><span class="p">:</span><span class="n">user</span><span class="o">/</span><span class="n">release</span><span class="o">-</span><span class="n">keys</span><span class="p">]</span>
</pre></div>
</div>
<p>2.安全补丁日期定制：</p>
<div class="highlight-diff notranslate"><div class="highlight"><pre><span></span><span class="w"> </span>system/core/init/property_service.cpp         | 148 +++++++++---------<span class="w"></span>
<span class="w"> </span>.../apps/Google/google/products/eea_common.mk |   1 -<span class="w"></span>
<span class="w"> </span>.../apps/Google/google/products/gms.mk        |   1 -<span class="w"></span>
<span class="w"> </span> .../rc_file/M50/init.mt6762_common_M50.rc     |  71 ++++-----<span class="w"></span>
<span class="w"> </span>.../rc_file/M50/init.mt6762_common_M50_eea.rc |  64 ++++----<span class="w"></span>
<span class="w"> </span>.../rc_file/M8/init.mt6762_common_M8.rc       |  61 ++++----<span class="w"></span>
<span class="w"> </span>.../rc_file/M8/init.mt6762_common_M8_eea.rc   |  69 ++++----<span class="w"></span>
<span class="w"> </span> build/make/core/version_defaults.mk           |   4 +-<span class="w"></span>
<span class="w"> </span>build/make/tools/buildinfo.sh                 |   5 +-<span class="w"></span>

<span class="gd">-- a/build/make/core/version_defaults.mk</span><span class="w"></span>
<span class="gi">+++ b/build/make/core/version_defaults.mk</span><span class="w"></span>
<span class="gu">@@ -240,9 +240,7 @@ ifndef PLATFORM_SECURITY_PATCH</span><span class="w"></span>
<span class="w"> </span>    #  It must be of the form &quot;YYYY-MM-DD&quot; on production devices.<span class="w"></span>
<span class="w"> </span>    #  It must match one of the Android Security Patch Level strings of the Public Security Bulletins.<span class="w"></span>
<span class="w"> </span>    #  If there is no $PLATFORM_SECURITY_PATCH set, keep it empty.<span class="w"></span>
<span class="gd">-    # [BUGFIX]-BEGIN by (wugangnan@paxsz.com), 2021/12/22 for keep the security patch date the same as at the time of certification,and define in rc file</span><span class="w"></span>
<span class="gd">-    #  PLATFORM_SECURITY_PATCH := 2021-11-05</span><span class="w"></span>
<span class="gd">-    # [BUGFIX]-END by (wugangnan@paxsz.com), 2021/12/22 for keep the security patch date the same as at the time of certification,and define in rc file</span><span class="w"></span>
<span class="gi">+      PLATFORM_SECURITY_PATCH := 2021-11-05</span><span class="w"></span>
<span class="w"> </span>endif<span class="w"></span>
<span class="w"> </span>.KATI_READONLY := PLATFORM_SECURITY_PATCH<span class="w"></span>
<span class="w"> </span>
<span class="gh">diff --git a/build/make/tools/buildinfo.sh b/build/make/tools/buildinfo.sh</span><span class="w"></span>
<span class="gh">index 7346ba35082..a00494cdd98 100755</span><span class="w"></span>
<span class="gd">--- a/build/make/tools/buildinfo.sh</span><span class="w"></span>
<span class="gi">+++ b/build/make/tools/buildinfo.sh</span><span class="w"></span>
<span class="gu">@@ -15,7 +15,10 @@ echo &quot;ro.build.version.codename=$PLATFORM_VERSION_CODENAME&quot;</span><span class="w"></span>
<span class="w"> </span>echo &quot;ro.build.version.all_codenames=$PLATFORM_VERSION_ALL_CODENAMES&quot;<span class="w"></span>
<span class="w"> </span>echo &quot;ro.build.version.release=$PLATFORM_VERSION_LAST_STABLE&quot;<span class="w"></span>
<span class="w"> </span>echo &quot;ro.build.version.release_or_codename=$PLATFORM_VERSION&quot;<span class="w"></span>
<span class="gd">-echo &quot;ro.build.version.security_patch=$PLATFORM_SECURITY_PATCH&quot;</span><span class="w"></span>
<span class="gi">+#[FEATURE]-Add-BEGIN by (lib@paxsz.com) 2021/12/21 add the pax security patch</span><span class="w"></span>
<span class="gi">+#echo &quot;ro.build.version.security_patch=$PLATFORM_SECURITY_PATCH&quot;</span><span class="w"></span>
<span class="gi">+echo &quot;ro.build.version.security_patch_pax=$PLATFORM_SECURITY_PATCH&quot;</span><span class="w"></span>
<span class="gi">+#[FEATURE]-Add-END by (lib@paxsz.com) 2021/12/21</span><span class="w"></span>
<span class="w"> </span>echo &quot;ro.build.version.base_os=$PLATFORM_BASE_OS&quot;<span class="w"></span>
<span class="w"> </span>echo &quot;ro.build.version.min_supported_target_sdk=$PLATFORM_MIN_SUPPORTED_TARGET_SDK_VERSION&quot;<span class="w"></span>
<span class="w"> </span>echo &quot;ro.build.date=`$DATE`&quot;<span class="w"></span>

<span class="w"> </span>--- a/paxdroid/device/rc_file/M50/init.mt6762_common_M50.rc<span class="w"></span>
<span class="gi">+++ b/paxdroid/device/rc_file/M50/init.mt6762_common_M50.rc</span><span class="w"></span>

<span class="gi">+    setprop ro.build.version.security_patch 2021-06-15</span><span class="w"></span>
<span class="gi">+    setprop ro.com.google.gmsversion 11_202104</span><span class="w"></span>

<span class="gd">--- a/teksun/packages/apps/Google/google/products/eea_common.mk</span><span class="w"></span>
<span class="gi">+++ b/teksun/packages/apps/Google/google/products/eea_common.mk</span><span class="w"></span>
<span class="gu">@@ -105,4 +105,3 @@ PRODUCT_PRODUCT_PROPERTIES += \</span><span class="w"></span>
<span class="w"> </span>    ro.setupwizard.rotation_locked=true \<span class="w"></span>
<span class="w"> </span>    setupwizard.theme=glif_v3_light \<span class="w"></span>
<span class="w"> </span>    ro.opa.eligible_device=true \<span class="w"></span>
<span class="gd">-    ro.com.google.gmsversion=11_202106</span><span class="w"></span>
<span class="gh">diff --git a/teksun/packages/apps/Google/google/products/gms.mk b/teksun/packages/apps/Google/google/products/gms.mk</span><span class="w"></span>
<span class="gh">index 19975a0e40f..fa1345560e2 100644</span><span class="w"></span>
<span class="gd">--- a/teksun/packages/apps/Google/google/products/gms.mk</span><span class="w"></span>
<span class="gi">+++ b/teksun/packages/apps/Google/google/products/gms.mk</span><span class="w"></span>
<span class="gu">@@ -132,4 +132,3 @@ PRODUCT_PRODUCT_PROPERTIES += \</span><span class="w"></span>
<span class="w"> </span>    ro.setupwizard.rotation_locked=true \<span class="w"></span>
<span class="w"> </span>    setupwizard.theme=glif_v3_light \<span class="w"></span>
<span class="w"> </span>    ro.opa.eligible_device=true \<span class="w"></span>
<span class="gd">-    ro.com.google.gmsversion=11_202108</span><span class="w"></span>
<span class="gd">-- </span><span class="w"></span>
</pre></div>
</div>
<ul class="simple">
<li><p>结果：</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">M50</span><span class="p">:</span>
<span class="p">[</span><span class="n">ro</span><span class="o">.</span><span class="n">build</span><span class="o">.</span><span class="n">version</span><span class="o">.</span><span class="n">security_patch</span><span class="p">]:</span> <span class="p">[</span><span class="mi">2021</span><span class="o">-</span><span class="mi">06</span><span class="o">-</span><span class="mi">05</span><span class="p">]</span>
<span class="p">[</span><span class="n">ro</span><span class="o">.</span><span class="n">build</span><span class="o">.</span><span class="n">version</span><span class="o">.</span><span class="n">security_patch_pax</span><span class="p">]:</span> <span class="p">[</span><span class="mi">2021</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mi">05</span><span class="p">]</span>
<span class="p">[</span><span class="n">ro</span><span class="o">.</span><span class="n">vendor</span><span class="o">.</span><span class="n">build</span><span class="o">.</span><span class="n">security_patch</span><span class="p">]:</span> <span class="p">[</span><span class="mi">2021</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mi">05</span><span class="p">]</span>
<span class="n">getprop</span> <span class="n">ro</span><span class="o">.</span><span class="n">com</span><span class="o">.</span><span class="n">google</span><span class="o">.</span><span class="n">gmsversion</span> <span class="p">:</span> <span class="mi">11_202104</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">M8</span><span class="p">:</span>
<span class="p">[</span><span class="n">ro</span><span class="o">.</span><span class="n">build</span><span class="o">.</span><span class="n">version</span><span class="o">.</span><span class="n">security_patch</span><span class="p">]:</span> <span class="p">[</span><span class="mi">2021</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mi">05</span><span class="p">]</span>
<span class="p">[</span><span class="n">ro</span><span class="o">.</span><span class="n">build</span><span class="o">.</span><span class="n">version</span><span class="o">.</span><span class="n">security_patch_pax</span><span class="p">]:</span> <span class="p">[</span><span class="mi">2021</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mi">05</span><span class="p">]</span>
<span class="p">[</span><span class="n">ro</span><span class="o">.</span><span class="n">vendor</span><span class="o">.</span><span class="n">build</span><span class="o">.</span><span class="n">security_patch</span><span class="p">]:</span> <span class="p">[</span><span class="mi">2021</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mi">05</span><span class="p">]</span>
<span class="n">getprop</span> <span class="n">ro</span><span class="o">.</span><span class="n">com</span><span class="o">.</span><span class="n">google</span><span class="o">.</span><span class="n">gmsversion</span> <span class="p">:</span> <span class="mi">11_202108</span>
</pre></div>
</div>
</section>
</section>
<section id="id6">
<h2>问题分析<a class="headerlink" href="#id6" title="Permalink to this headline"></a></h2>
<section id="modem-metaconnect">
<h3>1.modem meta无法connect<a class="headerlink" href="#modem-metaconnect" title="Permalink to this headline"></a></h3>
<ul class="simple">
<li><p>现象如下，卡在connect to AP这一步：</p></li>
</ul>
<p><img alt="0002_meta无法进入.png" src="src/0003_GMS/docs/images/0002_meta%E6%97%A0%E6%B3%95%E8%BF%9B%E5%85%A5.png" /></p>
<ul class="simple">
<li><p>原因：</p></li>
</ul>
<p>meta_init.mt6762_M50_V2.rc文件中未设置ro.build.version.security_patch属性，导致meta系统无法启动。</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, wugn.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
  

<script charset="UTF-8" id="LA_COLLECT" src="//sdk.51.la/js-sdk-pro.min.js"></script>
<script>LA.init({id: "JjOE14XScyd75b2C",ck: "JjOE14XScyd75b2C"})</script>

<br/>
<script id="LA-DATA-WIDGET" crossorigin="anonymous" charset="UTF-8" src="https://v6-widget.51.la/v6/JjOE14XScyd75b2C/quote.js?theme=0&f=12&display=1,0,0,0,0,0,1,1"></script>



</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>